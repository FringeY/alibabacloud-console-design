import React from 'react'
import { hot } from 'react-hot-loader'
import dva from 'dva'
import { Router } from 'dva/router'
import createLoading from 'dva-loading'
import { createBrowserHistory } from 'history'

import { 
  withIntlProvider, 
  registerRegion,
  ConsoleProvider,
 } from '@alicloud/console-design'
import "@alicloud/console-components/dist/wind.css";

import Routes from './routes'
import '../styles/index.less'
<% if(global.hasEntryCode){ %>
import entry from '~/app';
<% } %>
<% if(global.hasAppConfig){ %>
import appConfig from '~/appConfig';
<% } else { %>
const appConfig = {}
<% } %>

const app = dva({
  history: createBrowserHistory(),
})

app.use(registerRegion(app))
app.use(createLoading())

app.router(({ history }) => (
  <ConsoleProvider 
    app={app} 
    history={history}
    appConfig={appConfig}
  >
    <Router history={history}>
      <Routes />
    </Router>
  </ConsoleProvider>
))

const OriginApp = withIntlProvider()(app.start())
const App = process.env.NODE_ENV === 'development' ?
  hot(module)(OriginApp) :
  OriginApp

<% if (global.hasEntryCode){ %>
export default entry(app, App)
<% } else { %>
export default props => <App {...props} />
<% } %>
